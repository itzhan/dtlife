// 数据库：PostgreSQL
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Package {
  id          String   @id @default(uuid())
  name        String
  description String?
  remark      String?
  priceCents  Int      @default(0)
  originalPriceCents Int      @default(0)
  coverImageUrl     String?
  cardNumber        String?
  goodsCodeType     Int      @default(2)
  storeSourceId     Int?
  useLink           String?
  validUntil        DateTime?
  userPoints        Int      @default(0)
  storeId           String?
  goodsId           String?
  storeCount        Int      @default(0)
  primaryStoreName    String?
  primaryStoreAddress String?
  primaryStorePhone   String?
  storeDetails      Json?
  packageItems      Json?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  stocks      Stock[]
  loginCodes  LoginCode[]
}

// 库存，每一条代表一个核销码
model Stock {
  id         String   @id @default(uuid())
  code       String   @unique
  serialNumber Int?
  used       Boolean  @default(false)
  usedAt     DateTime?
  validUntil DateTime?
  orderNumber String?
  validDays   Int?
  createdAt  DateTime @default(now())
  packageId  String
  package    Package  @relation(fields: [packageId], references: [id], onDelete: Cascade)
  loginCodes LoginCode[]
}

// 登录码：用户通过该码进入并查看绑定的套餐
model LoginCode {
  id         String   @id @default(uuid())
  code       String   @unique
  active     Boolean  @default(true)
  expiresAt  DateTime?
  shareLink  String?
  orderNumber String?
  createdAt  DateTime @default(now())
  packageId  String
  package    Package  @relation(fields: [packageId], references: [id], onDelete: Cascade)
  stockId    String?   @unique
  stock      Stock?    @relation(fields: [stockId], references: [id])
}
